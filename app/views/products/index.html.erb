<h1 class="h3 mb-2 text-gray-800">Productos</h1>
<br />

<div class="container">
  <div class="row">
    <div class="col">
      <%= link_to new_product_path, { remote: true, class: "btn btn-info form-control" }  do %>
      <span class="fas fa-plus-square" ></span> Registrar nuevo producto
      <% end %>
    </div>
    <div class="col">
      <%# funcion para generar un reporte del inventario, en base al query %>
      <%= link_to products_path(request.params.merge(format: :pdf)), {class: "btn btn-primary form-control", target: :_blank} do %>
      <span class="fas fa-file-alt" ></span> Generar reporte de inventario
      <% end %>
    </div>
  </div>
</div>
<br />

<div class="d-flex align-items-center">
  <%= search_form_for @q, options = {class: "w-100 me-3"} do |f| %>
  <%= f.search_field :nombre_producto_or_codigo_producto_or_category_nombre_categoria_cont, options = {class: "form-control", placeholder: "Buscar por nombre o codigo..."} %>
  <%= f.submit "Buscar", class: "btn btn-info form-control" %>
  <% end %>
</div>
<br />

<div class="card shadow mb-4">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered" id="tablaProductos" width="100%" cellspacing="0">
	<thead>
	  <p> Listado de productos </p>
	  <tr>
	    <th>Codigo</th>
            <th>Nombre</th>
            <th>Existencias</th>
            <th>Precio</th>
	    <th>Ubicacion</th>
	    <th></th>
	  </tr>
	</thead>
	<tbody>
	  <% @productos.each do |prod| %>
	  <tr id="producto_<%= prod.id %>" >
	    <td><%= prod.codigo_producto %></td>
	    <td><%= prod.nombre_producto %></td>
	    <% if prod.existencia_producto <= prod.min_producto %>
	      <td class="bg-danger"><%= prod.existencia_producto %></td>
	    <% else %>
	      <td><%= prod.existencia_producto %></td>
	    <% end %>
	    <td>Bs <%= prod.precio_producto %></td>
	    <td><%= prod.location.nombre_lugar %></td>
	    <td>
	      <%= link_to "Ver", product_path(prod), html_options = {class: "btn btn-info btn-xs", remote: true} %>
	      <%= link_to "Editar", edit_product_path(prod), html_options = {class: "btn btn-info btn-xs", remote: true} %>
	      <%= link_to "Borrar", prod, remote: true, method: :delete, data: { confirm: "Borrar el producto: #{prod.nombre_producto}?"}, class: "btn btn-danger btn-xs" %>
	    </td>
	  </tr>
	  <% end %>
	</tbody>
      </table>
    </div>
  </div>
</div>
<%= render 'modal_productos' %>
