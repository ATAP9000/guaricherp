<h1 class="h3 mb-2 text-gray-800">Ventas</h1>
<br />

<%= search_form_for @search, url: search_sales_path, html: {method: :post} do |f| %>
<div class="row">
  <div class="col">
    <%= f.date_field :created_at_gteq, class: "form-control", placeholder: "Fecha de inicio..." %>
  </div>
  <div class="col">
    <%= f.date_field :created_at_lteq, class: "form-control", placeholder: "Fecha fin..." %>
  </div>
  <div class="col">
    <%= f.submit "Buscar", class: "btn btn-success form-control" %>
    <% end %>
  </div>
</div>
<br />

<div class="row">
  <div class="col">
    <%= link_to new_sale_path, {class: "btn btn-info form-control", id: "crear-venta-btn"}  do %>
    <span class="fas fa-plus-square"> </span>
    Realizar venta
    <%end%>
  </div>
  <div class="col">
    <%= link_to "Ventas de la semana", ventas_de_semana_path, class: "btn btn-info btn-xs form-control" %>
  </div>
  <div class="col">
    <%= link_to "Ventas del mes", ventas_del_mes_path, class: "btn btn-info btn-xs form-control"%>
  </div>
  <div class="col">
    <%= link_to sales_path(request.params.merge(format: :pdf)), {class: "btn btn-primary form-control", target: :_blank} do %>
    <span class="fas fa-file-alt" ></span> Generar reporte de ventas
    <% end %>
  </div>
</div>  
<br />

<div class="card shadow mb-4">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered" id="tabla_ventas" width="60%" cellspacing="0">
	<thead>
	  <tr>
	    <th>ID</th>
	    <th>Vendedor</th>
	    <th>Cliente</th>
	    <th>Total</th>
	    <th>Fecha y hora</th>
	    <th></th>
	  </tr>
	</thead>
	<tbody>
	  <% if @ventas.empty? %>
	  <tr>
	    <td> No hay ventas </td><td></td><td></td>
	  </tr>
	  <% else %>
	  <% @ventas.each do |venta| %>
	  <tr>
	    <td> <%= venta.try(:numero_venta) %> </td>
	    <td> <%= venta.user.username %> </td>
	    <td> <%= venta.try(:client).try(:nombre_cliente) %> </td>
            <td> Bs <%= venta.total_venta * 1.16 %> </td>
	    <td> <%= venta.created_at.strftime("%d-%m-%Y") %> </td>
	    <td> 
	      <%= link_to 'Mostrar', sale_path(venta), {class: "btn btn-info btn-xs", remote: true} %>
	      <%= link_to 'Borrar', venta, method: :delete, data: { confirm: 'Eliminar la venta?' }, class: "btn btn-danger btn-xs" %>
	    </td>
          </tr>
	  <% end %>
          <% end %>
	</tbody>
      </table>
    </div>
  </div>
</div>
<%= render 'modal_sales' %>
